var SEM_INIT=0,SEM_SENTENCE=1,SEM_INSERT_START=2,SEM_INSERT_TABLE_KNOWN=3,SEM_INSERT_VALUES=4,SEM_CREATE_START=5,SEM_CREATE_TABLE_KNOWN=6,SQL_TYPES={BIT:"boolean",BOOLEAN:"boolean",TINYINT:"boolean",SMALLINT:"int",INT:"int",BIGINT:"int",DECIMAL:"number",NUMERIC:"number",FLOAT:"number",DOUBLE:"number",REAL:"number",DATE:"date",DATETIME:"date",TIMESTAMP:"date",CHAR:"string",VARCHAR:"string",NCHAR:"string",NVARCHAR:"string",TEXT:"string",NTEXT:"string",SMALLTEXT:"string",MEDIUMTEXT:"string",BIGTEXT:"string"};window.SQLSemanticParser=function(e,t){this.onCreateTable=e||function(){},this.onInsert=t||function(){},this.sentence=[],this.status=SEM_INIT,this.lastWord=null},SQLSemanticParser.prototype.next=function(e,t){switch(this.status){case SEM_INIT:if("word"===t)"INSERT"===e.toUpperCase()?(this.sentence=[{word:e,type:t}],this.status=SEM_INSERT_START):(this.sentence=[{word:e,type:t}],this.status=SEM_SENTENCE);else{if("string"===t)throw new Error("Unexpected String: "+e);if("token"===t&&";"!==e)throw new Error("Unexpected token: "+e)}break;case SEM_SENTENCE:"word"===t&&"TABLE"===e.toUpperCase()&&this.sentence[0]&&"word"===this.sentence[0].type&&"CREATE"===this.sentence[0].word.toUpperCase()?this.status=SEM_CREATE_START:"token"===t&&";"===e&&(this.sentence=[],this.status=SEM_INIT);break;case SEM_INSERT_START:if("word"===this.lastWord.type&&"INTO"===this.lastWord.word.toUpperCase()){if("token"===t)throw new Error("Unexpected token: "+e);this.currentTable=e,this.status=SEM_INSERT_TABLE_KNOWN,this.currentFields=[],this.expecting="("}break;case SEM_INSERT_TABLE_KNOWN:switch(this.expecting){case"(":if("token"===t){if("("!==e)throw new Error("Unexpected token: "+e);this.expecting="field"}else{if("string"===t)throw new Error("Unexpected string: "+e);if("word"===t)throw new Error("Unexpected token: "+e)}break;case"field":if("word"!==t&&"string"!==t)throw new Error("Unexpected token: "+e);this.currentFields.push(e),this.expecting=",";break;case",":if("token"===t)if(")"===e)this.expecting="values";else{if(","!==e)throw new Error("Unexpected token: "+e);this.expecting="field"}else{if("string"===t)throw new Error("Unexpected string: "+e);if("word"===t)throw new Error("Unexpected token: "+e)}break;case"values":if("word"===t&&"VALUES"===e.toUpperCase())this.status=SEM_INSERT_VALUES,this.expecting="(";else{if("string"===t)throw new Error("Unexpected string: "+e);if("token"===t)throw new Error("Unexpected token: "+e)}}break;case SEM_INSERT_VALUES:switch(this.expecting){case"(":if("token"===t){if("("!==e)throw new Error("Unexpected token: "+e);this.expecting="field",this.currentData=[]}else{if("string"===t)throw new Error("Unexpected string: "+e);if("word"===t)throw new Error("Unexpected token: "+e)}break;case"field":if("word"===t&&"NULL"===e.toUpperCase())this.currentData.push(null),this.expecting=",";else{if("word"!==t&&"string"!==t)throw new Error("Unexpected token: "+e);this.currentData.push(e),this.expecting=","}break;case",":if("token"===t)if(")"===e)this.onInsert(this.currentTable,this.currentFields,this.currentData),this.expecting="next";else{if(","!==e)throw new Error("Unexpected token: "+e);this.expecting="field"}else{if("string"===t)throw new Error("Unexpected string: "+e);if("word"===t)throw new Error("Unexpected token: "+e)}break;case"next":"token"===t&&(";"===e?this.status=SEM_INIT:","===e&&(this.expecting="("))}break;case SEM_CREATE_START:if("token"===t)throw new Error("Unexpected token: "+e);"word"===t&&-1!==["IF","NOT","EXISTS"].indexOf(e.toUpperCase())||(this.currentTable=e,this.status=SEM_CREATE_TABLE_KNOWN,this.currentFieldsCreate=[],this.expecting="(");break;case SEM_CREATE_TABLE_KNOWN:switch(this.expecting){case"(":"token"===t&&"("===e&&(this.expecting="field-start",this.currentField={name:"",type:"",defaultVal:null});break;case"field-start":if("word"!==t&&"string"!==t)throw new Error("Unexpected token: "+e);this.currentField.name=e,this.expecting="field-type";break;case"field-type":"word"===t&&SQL_TYPES[e.toUpperCase()]?(this.currentField.type=SQL_TYPES[e.toUpperCase()],this.expecting="field-detail"):this.expecting="field-ignore";break;case"field-detail":"token"===t?"("===e?this.expecting="field-sub":","===e?(this.currentFieldsCreate.push(this.currentField),this.expecting="field-start",this.currentField={name:"",type:"",defaultVal:null}):")"===e&&(this.currentFieldsCreate.push(this.currentField),this.expecting="end"):this.lastWord&&"word"===this.lastWord.type&&"DEFAULT"===this.lastWord.word.toUpperCase()&&("word"===t&&"NULL"===e.toUpperCase()?this.currentField.defaultVal=null:this.currentField.defaultVal=e);break;case"field-sub":"token"===t&&")"===e&&(this.expecting="field-detail");break;case"field-sub-ignore":"token"===t&&")"===e&&(this.expecting="field-ignore");break;case"field-ignore":"token"===t&&("("===e?this.expecting="field-sub-ignore":","===e?(this.expecting="field-start",this.currentField={name:"",type:"",defaultVal:null}):")"===e&&(this.expecting="end"));break;case"end":"token"===t&&";"===e&&(this.onCreateTable(this.currentTable,this.currentFieldsCreate),this.status=SEM_INIT)}}this.lastWord={type:t,word:e}};